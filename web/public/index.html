<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Code Wiki</title>
  <link rel="stylesheet" href="/styles.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“š</text></svg>">
</head>
<body>
  <header>
    <div class="header-content">
      <h1><a href="/">Code Wiki</a></h1>
      <nav>
        <a href="/" class="nav-link active" data-page="search">Search</a>
        <a href="/browse" class="nav-link" data-page="browse">Browse</a>
        <a href="/login" class="nav-link" data-page="login" id="login-nav-link">Login</a>
        <div id="user-nav" class="user-nav" style="display: none;">
          <button id="new-doc-btn" class="btn btn-primary btn-sm">+ New</button>
          <img id="user-avatar" src="" alt="" class="user-avatar">
          <span id="user-name" class="user-name"></span>
          <button id="logout-btn" class="btn-link">Logout</button>
        </div>
      </nav>
    </div>
  </header>

  <main id="app">
    <!-- Search Page (default) -->
    <section id="page-search" class="page active">
      <div class="search-container">
        <h2>Search Code Wiki</h2>
        <div class="search-box">
          <input
            type="text"
            id="search-input"
            placeholder="Search wiki documents and repositories..."
            autocomplete="off"
          >
          <button id="search-btn" type="button">Search</button>
        </div>
        <div class="search-filters">
          <select id="filter-category">
            <option value="">All Categories</option>
          </select>
          <select id="filter-language">
            <option value="">All Languages</option>
          </select>
          <label class="toggle-label">
            <input type="checkbox" id="include-repo-files" checked>
            <span>Include repo files</span>
          </label>
        </div>
      </div>
      <div id="search-results" class="results-container">
        <p class="placeholder-text">Enter a search term to find wiki documents and code</p>
      </div>

      <!-- Quick View Table on Search Page -->
      <div class="quickview-section">
        <h3>Deployment Overview</h3>
        <p class="quickview-description">Repositories and their Netlify deployment status.</p>
        <div class="quickview-table-container">
          <table class="quickview-table" id="search-quickview-table">
            <thead>
              <tr>
                <th>Repository</th>
                <th>Staging</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody id="search-quickview-tbody">
              <tr>
                <td colspan="3" class="loading">Loading deployment data...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Browse Page -->
    <section id="page-browse" class="page">
      <h2>Browse Wiki</h2>
      <div class="categories-grid" id="categories-container">
        <!-- Categories loaded dynamically -->
      </div>
      <div id="category-content" class="category-content">
        <!-- Category documents loaded here -->
      </div>

      <div class="browse-repos-section">
        <h2>Browse Repos</h2>
        <div class="repo-tabs">
          <button class="repo-tab active" data-tab="files">Files View</button>
          <button class="repo-tab" data-tab="list">List View</button>
          <button class="repo-tab" data-tab="card">Card View</button>
          <button class="repo-tab" data-tab="quickview">Quick View</button>
        </div>

        <!-- Files View (Repos with .md files) -->
        <div id="repo-files-view" class="repo-view active">
          <div id="repo-files-content" class="repo-files-list">
            <p class="loading">Loading repository files...</p>
          </div>
        </div>

        <!-- List View (Repository Locations Index) -->
        <div id="repo-list-view" class="repo-view">
          <div id="repo-list-content" class="document-content">
            <p class="loading">Loading repository index...</p>
          </div>
        </div>

        <!-- Card View -->
        <div id="repo-card-view" class="repo-view">
          <div class="repo-filters">
            <select id="repo-status-filter">
              <option value="">All Status</option>
              <option value="synced">Synced</option>
              <option value="local-only">Local Only</option>
              <option value="github-only">GitHub Only</option>
            </select>
            <input type="text" id="repo-search" placeholder="Filter repositories...">
          </div>
          <div id="repos-container" class="repos-grid">
            <!-- Repos loaded dynamically -->
          </div>
        </div>

        <!-- Quick View (Deployment Table) -->
        <div id="repo-quickview-view" class="repo-view">
          <p class="quickview-description">Quick overview of repositories with their deployment status on Netlify.</p>
          <div class="quickview-table-container">
            <table class="quickview-table" id="quickview-table">
              <thead>
                <tr>
                  <th>Repository</th>
                  <th>Staging</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody id="quickview-tbody">
                <tr>
                  <td colspan="3" class="loading">Loading deployment data...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- Document View Page -->
    <section id="page-document" class="page">
      <div class="document-header">
        <a href="#" id="back-link" class="back-link">&larr; Back</a>
        <h2 id="document-title">Document Title</h2>
        <div id="document-meta" class="document-meta"></div>
        <button id="edit-btn" class="edit-btn" style="display: none;">Edit</button>
      </div>
      <article id="document-content" class="document-content">
        <!-- Document content loaded here -->
      </article>
    </section>

    <!-- Editor Page -->
    <section id="page-editor" class="page">
      <div class="editor-container">
        <div class="editor-header">
          <a href="#" id="editor-back-link" class="back-link">&larr; Cancel</a>
          <h2 id="editor-title">Edit Document</h2>
          <div class="editor-actions">
            <button id="editor-preview-toggle" class="btn btn-secondary">Preview</button>
            <button id="editor-save" class="btn btn-primary">Save &amp; Commit</button>
          </div>
        </div>

        <!-- Frontmatter Editor -->
        <div class="frontmatter-editor">
          <div class="form-row">
            <div class="form-group">
              <label for="edit-title">Title</label>
              <input type="text" id="edit-title" placeholder="Document title">
            </div>
            <div class="form-group">
              <label for="edit-language">Language</label>
              <select id="edit-language">
                <option value="">None</option>
                <option value="javascript">JavaScript</option>
                <option value="typescript">TypeScript</option>
                <option value="python">Python</option>
                <option value="go">Go</option>
                <option value="rust">Rust</option>
                <option value="java">Java</option>
                <option value="csharp">C#</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label for="edit-description">Description</label>
            <input type="text" id="edit-description" placeholder="Brief description">
          </div>
          <div class="form-group">
            <label for="edit-tags">Tags (comma-separated)</label>
            <input type="text" id="edit-tags" placeholder="api, patterns, typescript">
          </div>
        </div>

        <!-- Markdown Toolbar -->
        <div class="editor-toolbar">
          <button type="button" data-action="bold" title="Bold (Ctrl+B)"><strong>B</strong></button>
          <button type="button" data-action="italic" title="Italic (Ctrl+I)"><em>I</em></button>
          <button type="button" data-action="code" title="Inline Code">&lt;/&gt;</button>
          <button type="button" data-action="link" title="Link">&#128279;</button>
          <button type="button" data-action="heading" title="Heading">H</button>
          <button type="button" data-action="list" title="List">&#8226;</button>
          <button type="button" data-action="codeblock" title="Code Block">```</button>
        </div>

        <!-- Editor Area -->
        <div class="editor-main">
          <div class="editor-pane" id="editor-pane">
            <textarea id="editor-content" placeholder="Write your markdown content here..."></textarea>
          </div>
          <div class="preview-pane hidden" id="preview-pane">
            <div id="editor-preview" class="document-content"></div>
          </div>
        </div>

        <!-- Commit Message -->
        <div class="commit-section">
          <div class="form-group">
            <label for="commit-message">Commit Message</label>
            <input type="text" id="commit-message" placeholder="Describe your changes">
          </div>
        </div>

        <!-- Status Messages -->
        <div id="editor-status" class="editor-status"></div>
      </div>
    </section>

    <!-- Login Page -->
    <section id="page-login" class="page">
      <div class="auth-container">
        <h2>Sign In</h2>
        <p class="auth-notice">Sign in with your GitHub account to edit wiki documents.</p>
        <button id="github-login-btn" class="github-login-btn">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path d="M12 0C5.37 0 0 5.37 0 12c0 5.3 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 21.795 24 17.295 24 12c0-6.63-5.37-12-12-12"/>
          </svg>
          Sign in with GitHub
        </button>
        <p class="auth-info">
          Your edits will be committed to the wiki repository under your GitHub identity.
        </p>
      </div>
    </section>
  </main>

  <!-- New Document Modal -->
  <div id="new-doc-modal" class="modal" style="display: none;">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <h3>Create New Document</h3>
      <div class="form-group">
        <label for="new-doc-category">Category</label>
        <select id="new-doc-category">
          <option value="patterns">Patterns</option>
          <option value="utilities">Utilities</option>
          <option value="integrations">Integrations</option>
          <option value="templates">Templates</option>
          <option value="snippets">Snippets</option>
          <option value="projects">Projects</option>
        </select>
      </div>
      <div class="form-group">
        <label for="new-doc-filename">Filename</label>
        <input type="text" id="new-doc-filename" placeholder="my-document" autocomplete="off">
        <small class="form-hint">.md extension added automatically</small>
      </div>
      <div class="modal-actions">
        <button id="new-doc-cancel" class="btn btn-secondary">Cancel</button>
        <button id="new-doc-create" class="btn btn-primary">Create</button>
      </div>
    </div>
  </div>

  <footer>
    <p>Code Wiki &copy; 2025 | <a href="https://github.com/mindfu23/code-wiki" target="_blank">GitHub</a></p>
  </footer>

  <script src="/app.js"></script>
</body>
</html>

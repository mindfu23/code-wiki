<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Docsy McDocsface</title>
  <link rel="stylesheet" href="/styles.css">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#1e293b">
</head>
<body>
  <header>
    <div class="header-content">
      <a href="/" class="header-brand">
        <img src="/logo.png" alt="Docsy" class="header-logo">
        <div class="header-brand-text">
          <span class="header-title">Docsy McDocsface</span>
          <span class="header-subtitle">GitHub Repo Docsmeister</span>
        </div>
      </a>
      <nav>
        <a href="/browse" class="nav-link" data-page="browse">Browse</a>
        <a href="/login" class="nav-link" data-page="login" id="login-nav-link">Login</a>
        <div id="user-nav" class="user-nav" style="display: none;">
          <button id="new-doc-btn" class="btn btn-primary btn-sm">+ New</button>
          <img id="user-avatar" src="" alt="" class="user-avatar">
          <span id="user-name" class="user-name"></span>
          <button id="logout-btn" class="btn-link">Logout</button>
        </div>
      </nav>
    </div>
  </header>

  <main id="app">
    <!-- Search Page (default) -->
    <section id="page-search" class="page active">
      <div class="search-container">
        <div class="search-box">
          <input
            type="text"
            id="search-input"
            placeholder="Search wiki documents and repositories..."
            autocomplete="off"
          >
          <button id="search-btn" type="button">Search</button>
        </div>
        <div class="search-filters">
          <select id="filter-category">
            <option value="">All Categories</option>
          </select>
          <select id="filter-language">
            <option value="">All Languages</option>
          </select>
          <label class="toggle-label">
            <input type="checkbox" id="include-repo-files" checked>
            <span>Include repo files</span>
          </label>
        </div>
      </div>
      <div id="search-results" class="results-container"></div>

      <!-- Recently Modified Docs -->
      <div class="recent-docs-section">
        <div class="section-header-accent">
          <div class="cyan-accent-bar"></div>
          <h3>Recently Modified Docs</h3>
        </div>
        <div id="recent-docs-container">
          <p class="loading">Loading recent docs...</p>
        </div>
      </div>

      <!-- Quick View Table on Search Page -->
      <div class="quickview-section">
        <div class="quickview-header">
          <div class="section-header-accent">
            <div class="cyan-accent-bar"></div>
            <h3>Quick View</h3>
          </div>
          <button id="refresh-quickview-btn" class="btn btn-sm btn-secondary" title="Refresh index">↻ Refresh</button>
        </div>
        <div class="quickview-table-container">
          <table class="quickview-table" id="search-quickview-table">
            <thead>
              <tr>
                <th>Repository</th>
                <th>Staging</th>
                <th>Docs</th>
                <th>Notes <span class="header-hint">(click to add)</span></th>
              </tr>
            </thead>
            <tbody id="search-quickview-tbody">
              <tr>
                <td colspan="4" class="loading">Loading deployment data...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Browse Page -->
    <section id="page-browse" class="page">
      <div class="browse-repos-section">
        <div class="browse-breadcrumb">
          <nav class="breadcrumb-nav">
            <a href="/" class="breadcrumb-link" data-page="search">Main</a>
            <span class="breadcrumb-sep">›</span>
            <span class="breadcrumb-current">Browse</span>
          </nav>
        </div>
        <div class="repo-tabs" id="repo-tabs">
          <button class="repo-tab active" data-tab="contents">Contents</button>
          <button class="repo-tab" data-tab="docs">Docs View</button>
          <button class="repo-tab" data-tab="files" style="display: none;">Locations</button>
          <button class="repo-tab" data-tab="list">List View</button>
          <!-- Card View: hidden by default. To enable, set ENABLE_CARD_VIEW = true in app.js -->
          <button class="repo-tab" data-tab="card" data-optional="card-view" style="display: none;">Card View</button>
        </div>

        <!-- Contents View (Wiki outline) - default tab -->
        <div id="repo-contents-view" class="repo-view active">
          <div id="contents-outline" class="contents-outline">
            <!-- Wiki contents outline loaded dynamically -->
          </div>
        </div>

        <!-- Docs View (All doc files with sort/pagination) -->
        <div id="repo-docs-view" class="repo-view">
          <div id="repo-docs-content">
            <p class="loading">Loading doc files...</p>
          </div>
        </div>

        <!-- Locations (Repos with .md files, formerly "Files View") -->
        <div id="repo-files-view" class="repo-view">
          <div id="repo-files-content" class="repo-files-list">
            <p class="loading">Loading repository files...</p>
          </div>
        </div>

        <!-- List View (Repository Locations Index) -->
        <div id="repo-list-view" class="repo-view">
          <div id="repo-list-content" class="document-content">
            <p class="loading">Loading repository index...</p>
          </div>
        </div>

        <!-- Card View (optional, hidden by default) -->
        <div id="repo-card-view" class="repo-view">
          <div class="repo-filters">
            <select id="repo-status-filter">
              <option value="">All Status</option>
              <option value="synced">Synced</option>
              <option value="local-only">Local Only</option>
              <option value="github-only">GitHub Only</option>
            </select>
            <input type="text" id="repo-search" placeholder="Filter repositories...">
          </div>
          <div id="repos-container" class="repos-grid">
            <!-- Repos loaded dynamically -->
          </div>
        </div>

      </div>
    </section>

    <!-- Document View Page -->
    <section id="page-document" class="page">
      <div class="document-header">
        <a href="/browse" id="back-link" class="back-link">&larr; Main</a>
        <div id="document-meta" class="document-meta"></div>
      </div>
      <article id="document-content" class="document-content">
        <button id="edit-btn" class="edit-btn content-edit-btn" style="display: none;">Edit</button>
        <div id="document-body">
          <!-- Document content loaded here -->
        </div>
      </article>
    </section>

    <!-- Editor Page -->
    <section id="page-editor" class="page">
      <div class="editor-container">
        <div class="editor-header">
          <a href="#" id="editor-back-link" class="back-link">&larr; Cancel</a>
          <h2 id="editor-title">Edit Document</h2>
          <div class="editor-actions">
            <button id="editor-preview-toggle" class="btn btn-secondary">Preview</button>
            <button id="editor-save" class="btn btn-primary">Save &amp; Commit</button>
          </div>
        </div>

        <!-- Frontmatter Editor -->
        <div class="frontmatter-editor">
          <div class="form-row">
            <div class="form-group">
              <label for="edit-title">Title</label>
              <input type="text" id="edit-title" placeholder="Document title">
            </div>
            <div class="form-group">
              <label for="edit-language">Language</label>
              <select id="edit-language">
                <option value="">None</option>
                <option value="javascript">JavaScript</option>
                <option value="typescript">TypeScript</option>
                <option value="python">Python</option>
                <option value="go">Go</option>
                <option value="rust">Rust</option>
                <option value="java">Java</option>
                <option value="csharp">C#</option>
              </select>
            </div>
            <div class="form-group">
              <label for="edit-visibility">Visibility</label>
              <select id="edit-visibility">
                <option value="public">Public</option>
                <option value="private">Private</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label for="edit-description">Description</label>
            <input type="text" id="edit-description" placeholder="Brief description">
          </div>
          <div class="form-group">
            <label for="edit-tags">Tags (comma-separated)</label>
            <input type="text" id="edit-tags" placeholder="api, patterns, typescript">
          </div>
        </div>

        <!-- Markdown Toolbar -->
        <div class="editor-toolbar">
          <button type="button" data-action="bold" title="Bold (Ctrl+B)"><strong>B</strong></button>
          <button type="button" data-action="italic" title="Italic (Ctrl+I)"><em>I</em></button>
          <button type="button" data-action="code" title="Inline Code">&lt;/&gt;</button>
          <button type="button" data-action="link" title="Link">&#128279;</button>
          <button type="button" data-action="heading" title="Heading">H</button>
          <button type="button" data-action="list" title="List">&#8226;</button>
          <button type="button" data-action="codeblock" title="Code Block">```</button>
        </div>

        <!-- Editor Area -->
        <div class="editor-main">
          <div class="editor-pane" id="editor-pane">
            <textarea id="editor-content" placeholder="Write your markdown content here..."></textarea>
          </div>
          <div class="preview-pane hidden" id="preview-pane">
            <div id="editor-preview" class="document-content"></div>
          </div>
        </div>

        <!-- Commit Message -->
        <div class="commit-section">
          <div class="form-group">
            <label for="commit-message">Commit Message</label>
            <input type="text" id="commit-message" placeholder="Describe your changes">
          </div>
        </div>

        <!-- Status Messages -->
        <div id="editor-status" class="editor-status"></div>
      </div>
    </section>

    <!-- Login Page -->
    <section id="page-login" class="page">
      <div class="auth-container">
        <h2>Sign In</h2>
        <p class="auth-notice">Sign in with your GitHub account to edit wiki documents.</p>
        <button id="github-login-btn" class="github-login-btn">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path d="M12 0C5.37 0 0 5.37 0 12c0 5.3 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 21.795 24 17.295 24 12c0-6.63-5.37-12-12-12"/>
          </svg>
          Sign in with GitHub
        </button>
        <p class="auth-info">
          Your edits will be committed to the wiki repository under your GitHub identity.
        </p>
      </div>
    </section>
  </main>

  <!-- New Document Modal -->
  <div id="new-doc-modal" class="modal" style="display: none;">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <h3>Create New Document</h3>
      <div class="form-group">
        <label for="new-doc-category">Category</label>
        <select id="new-doc-category">
          <option value="patterns">Patterns</option>
          <option value="utilities">Utilities</option>
          <option value="integrations">Integrations</option>
          <option value="templates">Templates</option>
          <option value="snippets">Snippets</option>
          <option value="projects">Projects</option>
        </select>
      </div>
      <div class="form-group">
        <label for="new-doc-filename">Filename</label>
        <input type="text" id="new-doc-filename" placeholder="my-document" autocomplete="off">
        <small class="form-hint">.md extension added automatically</small>
      </div>
      <div class="form-group">
        <label for="new-doc-visibility">Visibility</label>
        <select id="new-doc-visibility">
          <option value="public">Public</option>
          <option value="private">Private</option>
        </select>
      </div>
      <div class="modal-actions">
        <button id="new-doc-cancel" class="btn btn-secondary">Cancel</button>
        <button id="new-doc-create" class="btn btn-primary">Create</button>
      </div>
    </div>
  </div>

  <!-- Repo Doc Modal -->
  <div id="repo-doc-modal" class="modal" style="display: none;">
    <div class="modal-backdrop" onclick="closeRepoDocModal()"></div>
    <div class="modal-content repo-doc-modal-content">
      <h3>Create Documentation</h3>
      <p class="repo-doc-subtitle">for <strong id="repo-doc-repo-name"></strong></p>
      <div class="form-group">
        <label for="repo-doc-filename">Filename</label>
        <input type="text" id="repo-doc-filename" value="README.md" autocomplete="off">
        <small class="form-hint">Supported: .md, .txt, .rst, .adoc, .org</small>
      </div>
      <div class="form-group">
        <label for="repo-doc-content">Content</label>
        <textarea id="repo-doc-content" rows="12" placeholder="Write your documentation..."></textarea>
      </div>
      <div id="repo-doc-status" class="editor-status"></div>
      <div class="modal-actions">
        <button onclick="closeRepoDocModal()" class="btn btn-secondary">Cancel</button>
        <button id="repo-doc-save" onclick="saveRepoDoc()" class="btn btn-primary">Save & Commit</button>
      </div>
    </div>
  </div>

  <footer>
    <p>Docsy McDocsface <a href="https://github.com/mindfu23/code-wiki" target="_blank">GitHub</a></p>
  </footer>

  <script src="/app.js"></script>
</body>
</html>
